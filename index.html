<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directional Skills Learning Game</title>
    <meta name="description" content="Educational game for learning directional key controls designed for students with physical and learning difficulties">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
</head>
<body>
    <!-- Skip Link for Screen Readers -->
    <a href="#game-canvas" class="skip-link">Skip to game</a>
    
    <!-- Card-Based Main Menu -->
    <div class="main-menu" id="main-menu" role="region" aria-label="Main menu">
        <div class="menu-header">
            <h1 class="game-title">Move Lab</h1>
        </div>
        
        <div class="menu-cards" role="navigation" aria-label="Main menu options">
            <button class="menu-card primary-card" id="configure-session-btn" 
                    aria-label="Create a new game with custom settings">
                <span class="material-icons card-icon">add_circle</span>
                <div class="card-content">
                    <h2 class="card-title">Create Game</h2>
                    <p class="card-description">Design your own challenge</p>
                </div>
            </button>
            
            <button class="menu-card" id="play-replay-btn" 
                    aria-label="Play a game using a replay code">
                <span class="material-icons card-icon">replay</span>
                <div class="card-content">
                    <h2 class="card-title">Play Replay Code</h2>
                    <p class="card-description">Enter a code to play the same challenge</p>
                </div>
            </button>
            
            <button class="menu-card" id="progress-history-btn" 
                    aria-label="View progress and history">
                <span class="material-icons card-icon">analytics</span>
                <div class="card-content">
                    <h2 class="card-title">Progress & History</h2>
                    <p class="card-description">Review your achievements</p>
                </div>
            </button>
            
            <button class="menu-card" id="help-support-btn" 
                    aria-label="Get help and support">
                <span class="material-icons card-icon">help</span>
                <div class="card-content">
                    <h2 class="card-title">Help & Support</h2>
                    <p class="card-description">Instructions and accessibility options</p>
                </div>
            </button>
        </div>
        
        <!-- Secondary Actions -->
        <div class="menu-secondary" role="toolbar" aria-label="Secondary options">
            <button class="secondary-btn" id="sound-toggle-btn" 
                    aria-label="Toggle sound">
                <span class="material-icons">volume_up</span>
                <span class="btn-label">Sound</span>
            </button>
            
            <button class="secondary-btn" id="fullscreen-toggle-btn" 
                    aria-label="Toggle fullscreen">
                <span class="material-icons">fullscreen</span>
                <span class="btn-label">Fullscreen</span>
            </button>
        </div>
    </div>

    <!-- Game Interface (Hidden initially) -->
    <div class="game-interface" id="game-interface" style="display: none;">
        <!-- Main Game Area -->
        <main class="game-container" role="main">
            <!-- Game Canvas -->
            <canvas id="game-canvas" 
                    role="application"
                    aria-label="Directional Skills Practice Game"
                    tabindex="0">
                <p>This game requires a modern browser with HTML5 Canvas support.</p>
            </canvas>
            
            <!-- Game Metrics Overlay (Non-Distracting) -->
            <div class="metrics-overlay" aria-live="polite">
                <div class="metric-item" id="session-display">
                    <span class="metric-label">Time:</span>
                    <span class="metric-value" id="current-session-time">00:00</span>
                </div>
            </div>
            
            <!-- Progress Bar Overlay -->
            <div class="progress-overlay">
                <div class="progress-container">
                    <div class="progress-bar" role="progressbar" 
                         aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
                         aria-label="Core targets completion progress">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <dialog class="modal" id="settings-modal" aria-labelledby="settings-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settings-title">Game Settings</h2>
                <button class="modal-close" aria-label="Close settings">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="settings-form">
                    <fieldset>
                        <legend>Movement Settings</legend>
                        <label for="movement-speed">Movement Speed:</label>
                        <input type="range" id="movement-speed" min="1" max="5" value="3">
                        
                        <label>
                            <input type="checkbox" id="input-buffering" checked> 
                            Input Buffering (Makes controls more forgiving)
                        </label>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Accessibility</legend>
                        <label>
                            <input type="checkbox" id="audio-enabled" checked> 
                            Enable Audio Feedback
                        </label>
                        
                        <label>
                            <input type="checkbox" id="reduced-motion"> 
                            Reduce Motion Effects
                        </label>
                        
                        <label for="resize-handling">Window Resize Behavior:</label>
                        <select id="resize-handling">
                            <option value="reposition">Keep targets visible (move if needed)</option>
                            <option value="scale">Scale targets proportionally</option>
                            <option value="regenerate">Generate new target positions</option>
                            <option value="pause">Pause game during resize</option>
                        </select>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="save-settings">Save Settings</button>
                <button class="btn btn-secondary" id="cancel-settings">Cancel</button>
            </div>
        </div>
    </dialog>

    <!-- Session Setup Modal -->
    <dialog class="modal practice-modal" id="session-modal" aria-labelledby="session-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="session-title">Create Your Game</h2>
                <button class="modal-close" aria-label="Close game creation">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="session-form">
                    <fieldset>
                        <legend>Session Configuration</legend>
                        

                        
                        <div class="form-group">
                            <label>Target Configuration:</label>
                            <div class="target-sliders">
                                <div class="target-slider-group">
                                    <label for="target-static-count">Static Targets:</label>
                                    <div class="input-with-value">
                                        <input type="range" id="target-static-count" min="0" max="10" value="5">
                                        <span id="target-static-count-value" class="range-value">5</span>
                                    </div>
                                    <small class="field-help">Basic stationary targets for fundamental navigation practice</small>
                                </div>
                                
                                <div class="target-slider-group">
                                    <label for="target-moving-count">Moving Targets:</label>
                                    <div class="input-with-value">
                                        <input type="range" id="target-moving-count" min="0" max="10" value="0">
                                        <span id="target-moving-count-value" class="range-value">0</span>
                                    </div>
                                    <small class="field-help">Targets that move slowly in predictable patterns</small>
                                </div>
                                
                                <div class="target-slider-group">
                                    <label for="target-flee-count">Fleeing Targets:</label>
                                    <div class="input-with-value">
                                        <input type="range" id="target-flee-count" min="0" max="10" value="0">
                                        <span id="target-flee-count-value" class="range-value">0</span>
                                    </div>
                                    <small class="field-help">Advanced targets that move away when approached</small>
                                </div>
                                
                                <div class="target-slider-group">
                                    <label for="target-bonus-count">Bonus Targets:</label>
                                    <div class="input-with-value">
                                        <input type="range" id="target-bonus-count" min="0" max="10" value="0">
                                        <span id="target-bonus-count-value" class="range-value">0</span>
                                    </div>
                                    <small class="field-help">Special targets that reduce time when collected (optional reward)</small>
                                </div>
                                
                                <div class="target-slider-group">
                                    <label for="target-hazard-count">Hazard Targets:</label>
                                    <div class="input-with-value">
                                        <input type="range" id="target-hazard-count" min="0" max="10" value="0">
                                        <span id="target-hazard-count-value" class="range-value">0</span>
                                    </div>
                                    <small class="field-help">Targets to avoid - add time penalty when touched (optional challenge)</small>
                                </div>
                                
                                <div class="total-targets">
                                    <strong>Total Targets: <span id="total-targets-value">5</span></strong>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Target Size:</label>
                            <div class="radio-group">
                                <label><input type="radio" name="target-size" value="small"> Small</label>
                                <label><input type="radio" name="target-size" value="medium" checked> Medium</label>
                                <label><input type="radio" name="target-size" value="large"> Large</label>
                                <label><input type="radio" name="target-size" value="extra-large"> Extra Large</label>
                            </div>
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Player Movement</legend>
                        
                        <div class="form-group">
                            <label for="player-speed">Movement Speed:</label>
                            <div class="input-with-value">
                                <input type="range" id="player-speed" min="1" max="5" value="3">
                                <span id="player-speed-value" class="range-value">Normal</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Movement Trail:</label>
                            <div class="radio-group">
                                <label><input type="radio" name="player-trail" value="off"> Off</label>
                                <label><input type="radio" name="player-trail" value="short" checked> Short</label>
                                <label><input type="radio" name="player-trail" value="long"> Long</label>
                            </div>
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Input Methods</legend>
                        
                        <div class="form-group">
                            <label>Control Method:</label>
                            <div class="radio-group">
                                <label><input type="radio" name="input-method" value="discrete" checked> Discrete Movement (Arrow Keys + WASD)</label>
                                <label><input type="radio" name="input-method" value="continuous"> Continuous Movement (Snake-style)</label>
                                <label><input type="radio" name="input-method" value="mouse"> Mouse Click-to-Move</label>
                            </div>
                            <small class="field-help">Choose one control method. Discrete: press and hold keys. Continuous: single press changes direction. Mouse: point and click.</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="input-buffer">Input Buffer Time:</label>
                            <div class="input-with-value">
                                <input type="range" id="input-buffer" min="0" max="450" value="300" step="50">
                                <span id="input-buffer-value" class="range-value">300ms</span>
                            </div>
                            <small class="field-help">Range: 0‚Äì450ms (50ms steps). Higher buffers improve forgiveness but may feel less responsive.</small>
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Game Environment</legend>
                        
                        <div class="form-group">
                            <label>Boundaries:</label>
                            <div class="radio-group">
                                <label><input type="radio" name="game-boundaries" value="none" checked> None</label>
                                <label><input type="radio" name="game-boundaries" value="visual"> Visual Guidelines</label>
                                <label><input type="radio" name="game-boundaries" value="hard"> Hard Walls</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Feedback Options:</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="feedback-audio" checked> Audio Feedback</label>
                                <label><input type="checkbox" id="feedback-visual" checked> Visual Effects</label>
                                <label><input type="checkbox" id="feedback-haptic"> Haptic Feedback</label>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="start-session">Create Game</button>
                <button class="btn btn-secondary" id="cancel-session">Cancel</button>
            </div>
        </div>
    </dialog>

    <!-- Replay Code Entry Modal -->
    <dialog class="modal" id="replay-modal" aria-labelledby="replay-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="replay-title">Play Replay Code</h2>
                <button class="modal-close" aria-label="Close replay code entry">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="replay-input-section">
                    <label for="replay-code-input">Enter Replay Code:</label>
                    <input type="text" id="replay-code-input" placeholder="e.g., 10000130060110" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="start-replay">Play Challenge</button>
                <button class="btn btn-secondary" id="cancel-replay">Cancel</button>
            </div>
        </div>
    </dialog>

    <!-- Help Modal -->
    <dialog class="modal" id="help-modal" aria-labelledby="help-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="help-title">How to Play</h2>
                <button class="modal-close" aria-label="Close help">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="quick-start">
                    <h3>üéØ Your Mission</h3>
                    <p>Move around and collect all the green circles. That's it!</p>
                </div>
                
                <div class="controls-section">
                    <h3>üéÆ How to Move</h3>
                    <div class="control-options">
                        <div class="control-option">
                            <strong>‚å®Ô∏è Keyboard:</strong> Arrow keys or WASD
                        </div>
                        <div class="control-option">
                            <strong>üñ±Ô∏è Mouse:</strong> Click where you want to go
                        </div>
                    </div>
                </div>
                
                <div class="quick-tips">
                    <h3>üí° Quick Tips</h3>
                    <div class="tip-grid">
                        <div class="tip">Press <kbd>ESC</kbd> to pause anytime</div>
                        <div class="tip">No timer pressure - go at your own pace</div>
                        <div class="tip">Share challenge codes with friends</div>
                        <div class="tip">Can't lose - just practice and improve!</div>
                    </div>
                </div>
                
                <div class="ready-message">
                    <strong>Ready to start your first challenge?</strong>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="close-help">Got it!</button>
            </div>
        </div>
    </dialog>

    <!-- Session Results Modal -->
    <dialog class="modal results-modal" id="results-modal" aria-labelledby="results-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="results-title">üéâ Game Complete!</h2>
                <button class="modal-close" aria-label="Close game results">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Achievement Banner -->
                <div class="achievement-banner" id="achievement-banner" style="display: none;">
                    <span class="material-icons achievement-icon">emoji_events</span>
                    <span id="achievement-text">New Personal Best!</span>
                </div>
                
                <!-- Main Time Display -->
                <div class="completion-time">
                    <div class="time-label">Your Time</div>
                    <div class="time-value" id="results-time">0:00</div>
                </div>
                
                <!-- Optional Stats (only shown if non-zero) -->
                <div class="optional-stats" id="optional-stats">
                    <div class="stat-item" id="bonus-stat" style="display: none;">
                        <span class="stat-icon">‚≠ê</span>
                        <span class="stat-text"><span id="results-bonus-targets">0</span> bonus collected</span>
                    </div>
                    <div class="stat-item" id="hazard-stat" style="display: none;">
                        <span class="stat-icon">‚ö†Ô∏è</span>
                        <span class="stat-text"><span id="results-hazard-targets">0</span> hazards hit</span>
                    </div>
                </div>
                
                <!-- Replay Code Section -->
                <div class="replay-code-section">
                    <div class="code-label">Share this challenge</div>
                    <div class="code-container">
                        <span class="code-value" id="results-seed">-</span>
                        <button class="btn btn-copy" id="copy-replay-code">
                            <span class="material-icons">content_copy</span>
                            Copy
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="replay-game">
                    <span class="material-icons">replay</span>
                    Play Again
                </button>
                <button class="btn btn-secondary" id="new-session">
                    <span class="material-icons">add</span>
                    New Game
                </button>
                <button class="btn btn-tertiary" id="close-results">Close</button>
            </div>
        </div>
    </dialog>

    <!-- Statistics Modal -->
    <dialog class="modal" id="stats-modal" aria-labelledby="stats-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="stats-title">Your Progress & History</h2>
                <button class="modal-close" aria-label="Close statistics">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Sessions Played</h3>
                        <div class="stat-value" id="stats-sessions">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Total Targets</h3>
                        <div class="stat-value" id="stats-targets">0</div>
                    </div>
                </div>
                
                <div class="session-history-section">
                    <div class="history-header">
                        <h3>Recent Sessions</h3>
                        <button class="btn btn-danger clear-history-btn" id="clear-history-btn">
                            Clear All History
                        </button>
                    </div>
                    <div class="session-history" id="session-history">
                        <div class="no-sessions">
                            <p>No sessions completed yet.</p>
                            <p>Complete your first session to see your progress history!</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="close-stats">Close</button>
            </div>
        </div>
    </dialog>

    <!-- Pause/Quit Modal -->
    <dialog class="modal pause-modal" id="pause-modal" aria-labelledby="pause-title">
        <div class="modal-content">
            <div class="modal-body">
                <div class="pause-actions">
                    <button class="pause-action-btn primary-action" id="resume-session-btn" 
                            aria-label="Resume practice session">
                        <span class="material-icons">play_arrow</span>
                        <span class="action-text">Resume</span>
                        <small>Space</small>
                    </button>
                    
                    <button class="pause-action-btn secondary-action" id="quit-session-btn" 
                            aria-label="Quit session and return to menu">
                        <span class="material-icons">exit_to_app</span>
                        <span class="action-text">Quit</span>
                        <small>Escape</small>
                    </button>
                </div>
            </div>
        </div>
    </dialog>

    <!-- ARIA Live Regions for Screen Readers -->
    <div aria-live="polite" id="game-status" class="sr-only"></div>
    <div aria-live="assertive" id="game-alerts" class="sr-only"></div>

    <!-- Core Scripts (architecture scaffolding) -->
    <script src="core/events.js"></script>
    <script src="core/scene-manager.js"></script>
    <script src="core/engine.js"></script>
    <script src="core/replay-code.js"></script>
    <script src="core/game-scene.js"></script>
    <script src="mini-games/registry.js"></script>
    <script src="mini-games/directional-practice.js"></script>

    <!-- Game Script -->
        <script src="game.js"></script>
        <script>
            // Bootstrap the SceneManager + Engine and mount the main game scene once DOM is ready
            window.addEventListener('DOMContentLoaded', function () {
                if (!window.SceneManager || !window.Engine || !window.GameScene) return;
                try {
                    var canvas = document.getElementById('game-canvas');
                    var ctx = canvas ? canvas.getContext('2d') : null;
                    if (!ctx) return;
                    window.sceneManager = window.sceneManager || new window.SceneManager();
                    window.engine = window.engine || new window.Engine(ctx);
                    // Register and switch to main scene wrapping existing game instance
                    if (!window._mainSceneRegistered) {
                        window.sceneManager.register('main', new window.GameScene());
                        window._mainSceneRegistered = true;
                    }
                    window.sceneManager.switch('main');
                    if (!window.engine.running) {
                        window.engine.start(window.sceneManager);
                    }
                } catch (e) {
                    console.warn('Engine bootstrap failed:', e);
                }
            });
        </script>
</body>
</html>< ! - -   T r i g g e r   P a g e s   d e p l o y m e n t   - - > 
 
 